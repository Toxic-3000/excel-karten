<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Excel → Karten</title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7f9; color: #111; }

    header{
      position: sticky; top: 0; z-index: 10;
      background:#fff; border-bottom:1px solid #e7e7e7;
      padding:12px 14px; display:grid; gap:10px;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    input[type="file"]{ max-width:100%; }
    input[type="search"], select, button{
      flex:1; min-width:170px;
      padding:10px 12px; border:1px solid #ddd; border-radius:12px;
      background:#fff; font-size:14px;
    }
    button{ cursor:pointer; }
    button:disabled{ opacity:.6; cursor:not-allowed; }

    main{ padding:14px; }
    .hint{ color:#666; font-size:13px; line-height:1.4; }
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
      gap:12px;
    }
    .card{
      background:#fff; border:1px solid #e9e9e9; border-radius:16px;
      padding:12px; box-shadow:0 1px 2px rgba(0,0,0,.04);
      display:grid; gap:10px;
    }
    .title{ font-weight:700; font-size:16px; line-height:1.2; }
    .meta{ font-size:12px; color:#555; display:flex; gap:8px; flex-wrap:wrap; }
    .pill{ background:#eef2ff; color:#2536a4; padding:4px 8px; border-radius:999px; }
    .kv{ display:grid; gap:6px; }
    .kv .line{ display:grid; grid-template-columns:120px 1fr; gap:10px; align-items:start; }
    .k{ color:#666; font-size:12px; }
    .v{ font-size:13px; word-break:break-word; }

    details{ border-top:1px solid #eee; padding-top:8px; }
    summary{ cursor:pointer; color:#2536a4; font-size:13px; user-select:none; }

    a{ color:#2536a4; text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .urlhint{
      display:block;
      margin-top:4px;
      font-size:11px;
      color:#777;
      word-break: break-all;
    }

    .footer{ padding:0 14px 14px; color:#666; font-size:12px; }
  </style>
</head>

<body>
<header>
  <div class="row">
    <strong>Excel → Karten</strong>
    <span class="hint">XLSX + Hyperlinks (Store Link klickbar, URL als Tooltip)</span>
  </div>

  <div class="row">
    <input id="file" type="file" accept=".xlsx,.xls,.csv">
    <select id="sheetSelect" disabled>
      <option>Sheet auswählen…</option>
    </select>
  </div>

  <div class="row">
    <input id="search" type="search" placeholder="Suche… (z.B. 'Yakuza', 'Capcom', '643')" disabled>
    <button id="moreBtn" disabled>Mehr laden</button>
    <button id="topBtn" disabled>↑ Top</button>
  </div>

  <div class="row">
    <span class="hint" id="status">Datei wählen → (XLSX: Sheet wählen) → suchen.</span>
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
</main>

<div id="footer" class="footer"></div>

<!-- SheetJS lokal im Repo -->
<script src="xlsx.full.min.js"></script>

<script>
  const els = {
    file: document.getElementById("file"),
    sheetSelect: document.getElementById("sheetSelect"),
    search: document.getElementById("search"),
    moreBtn: document.getElementById("moreBtn"),
    topBtn: document.getElementById("topBtn"),
    status: document.getElementById("status"),
    grid: document.getElementById("grid"),
    footer: document.getElementById("footer"),
  };

  // === Performance-Tuning für große Listen ===
  const INITIAL_RENDER = 0;     // 0 = erst nach Suche rendern (Android-freundlich)
  const PAGE_SIZE = 70;         // Karten pro "Mehr laden"
  const MAX